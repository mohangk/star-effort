<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🚀 Add New Mission - Star Effort Chart ⭐</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>🚀 NEW SPACE MISSION ⭐</h1>
            <p class="subtitle">Record a completed task and earn Star Dollars!</p>
        </header>

        <main class="main-content">
            <div class="form-container">
                <form id="task-form">
                    <div class="form-group">
                        <label for="task-date">🗓️ Mission Date:</label>
                        <input type="date" id="task-date" name="date" required>
                    </div>

                    <div class="form-group">
                        <label for="child-name">👨‍🚀 Space Explorer:</label>
                        <select id="child-name" name="childName" required>
                            <option value="">Choose your space explorer...</option>
                            <option value="ASHA">👩‍🚀 ASHA</option>
                            <option value="EKAA">👨‍🚀 EKAA</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="mission-select">🚀 Choose Mission:</label>
                        <select id="mission-select" name="missionId" required>
                            <option value="">Choose your mission...</option>
                            <!-- Missions will be populated by JavaScript -->
                        </select>
                    </div>

                    <div class="form-group mission-preview" id="mission-preview" style="display: none;">
                        <div class="mission-details">
                            <strong>Mission Details:</strong>
                            <div id="selected-mission-description"></div>
                            <div id="selected-mission-reward"></div>
                        </div>
                    </div>

                    <div class="form-buttons">
                        <button type="submit" class="btn btn-primary">
                            🌟 Complete Mission 🌟
                        </button>
                        <a href="index.html" class="btn btn-secondary">🔙 Back to Chart</a>
                        <a href="manage-rewards.html" class="btn btn-secondary">🛰️ Astral Rewards Bay</a>
                    </div>
                </form>
            </div>
        </main>

        <footer class="footer">
            <p>🌟 Every effort counts in our space adventure! 🌟</p>
        </footer>
    </div>

    <!-- Firebase SDKs -->
    <script type="module" src="firebase-setup.js"></script>
    <script src="script.js"></script>
    <script>
        // Initialize add task page
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🔧 DOM loaded on add-task page...');
            
            // Firebase should already be ready (script.js handles the firebase-ready event)
            if (window.isFirebaseReady) {
                console.log('✅ Firebase ready, initializing add task page...');
                initializeAddTaskPage();
            } else {
                console.error('❌ Firebase not ready - script.js should have handled this');
                alert('🔧 App initialization error. Please refresh the page.');
            }
        });
        
        function initializeAddTaskPage() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('task-date').value = today;
            
            // Load missions dropdown
            loadMissionsDropdown();
            
            // Set up mission selection preview
            const missionSelect = document.getElementById('mission-select');
            const missionPreview = document.getElementById('mission-preview');
            const missionDescription = document.getElementById('selected-mission-description');
            const missionReward = document.getElementById('selected-mission-reward');
            
            missionSelect.addEventListener('change', function() {
                if (this.value) {
                    const selectedOption = this.options[this.selectedIndex];
                    const description = selectedOption.dataset.description;
                    const starDollars = selectedOption.dataset.starDollars;
                    
                    missionDescription.textContent = description;
                    missionReward.innerHTML = `Reward: ${getStarEmoji(starDollars)} ${starDollars} Star Dollars`;
                    missionPreview.style.display = 'block';
                } else {
                    missionPreview.style.display = 'none';
                }
            });
        }
    </script>
</body>
</html>